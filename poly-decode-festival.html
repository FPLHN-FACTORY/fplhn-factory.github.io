<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Poly Decode Festival - Ranking Board</title>
  <style>
    /* ===== Base Page Style ===== */
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      text-align: center;
      padding: 40px 20px 10px;
    }

    header h1 {
      margin: 0;
      font-size: 2.5rem;
      color: #ff6600;
    }

    header h2 {
      margin: 8px 0 0;
      font-weight: normal;
      color: #444;
      font-size: 1.1rem;
    }

    /* ===== Tabs ===== */
    .tabs {
      display: flex;
      justify-content: center;
      margin: 20px 0;
      gap: 10px;
    }

    .tab-button {
      background: white;
      border: 2px solid #ff6600;
      color: #ff6600;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .tab-button.active {
      background: #ff6600;
      color: white;
      box-shadow: 0 3px 10px rgba(255, 102, 0, 0.3);
    }

    .tab-button:hover {
      background: #ff6600;
      color: white;
    }

    /* ===== Table Styles ===== */
    table {
      border-collapse: collapse;
      width: 90%;
      max-width: 800px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      margin-bottom: 60px;
      display: none;
    }

    table.active {
      display: table;
      animation: fadeIn 0.4s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    thead {
      background-color: #ff6600;
      color: white;
    }

    th, td {
      padding: 14px 16px;
      text-align: left;
    }

    th {
      text-transform: uppercase;
      font-size: 0.9rem;
      letter-spacing: 1px;
    }

    tbody tr {
      border-bottom: 1px solid #f0f0f0;
      transition: background 0.2s;
    }

    tbody tr:hover {
      background-color: #f9f9f9;
    }

    /* ===== Rank Highlight Styles ===== */
    .top-n {
      background: linear-gradient(90deg, #fff8e1, #fff3c4);
      font-weight: 600;
    }

    .top-3:nth-child(1) td.rank { color: #d4af37; font-weight: bold; }
    .top-3:nth-child(2) td.rank { color: #c0c0c0; font-weight: bold; }
    .top-3:nth-child(3) td.rank { color: #cd7f32; font-weight: bold; }

    /* ===== Footer ===== */
    footer {
      margin-top: auto;
      padding: 20px;
      font-size: 0.9rem;
      color: #666;
    }

    @media (max-width: 600px) {
      th, td { font-size: 0.85rem; padding: 10px; }
      header h1 { font-size: 2rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Poly Decode Festival</h1>
    <h2>Official Ranking Board - FPT Polytechnic</h2>
  </header>

  <div class="tabs">
    <button class="tab-button active" data-target="individual-table">Individual</button>
    <button class="tab-button" data-target="team-table">Team</button>
  </div>

  <!-- Individual Ranking Table -->
  <table id="individual-table" class="active">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Email</th>
        <th>Score</th>
      </tr>
    </thead>
    <tbody id="individual-body">
      <tr><td colspan="3" style="text-align:center;">Loading data...</td></tr>
    </tbody>
  </table>

  <!-- Team Ranking Table -->
  <table id="team-table">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Team Code</th>
        <th>Score</th>
        <th>Members</th>
      </tr>
    </thead>
    <tbody id="team-body">
      <tr><td colspan="3" style="text-align:center;">Loading data...</td></tr>
    </tbody>
  </table>

  <footer>
    © 2025 FPT Polytechnic • Poly Decode Festival
  </footer>

  <script>
    // CSV URLs
    const urls = {
      individual: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTVAqK_FV8ipob5WKvg5-YRVsxZRsA0FAOUON2zn1UUQKZWXKXD8zwFsN2_lml5rgjAY1apsSPqogoB/pub?gid=904550547&single=true&output=csv',
      team: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQMvwwimz2ARrjCWPTrpp0N4YgKJclYCG1xYBv0-YvN8seMZwSwce0C7InF2pPLqMYSO3P6kLT48cah/pub?gid=1017755022&single=true&output=csv'
    };

    // Fetch and parse CSV
    async function fetchCSVIndividual(url) {
      const response = await fetch(url);
      if (!response.ok) throw new Error('Network response was not ok');
      const text = await response.text();
      return parseCSVIndividual(text);
    }
    
    async function fetchCSVTeam(url) {
      const response = await fetch(url);
      if (!response.ok) throw new Error('Network response was not ok');
      const text = await response.text();
      return parseCSVTeam(text);
    }

    function parseCSVIndividual(csvText) {
      const lines = csvText.trim().split('\n');
      lines.shift(); // remove header
      return lines.map(line => {
        const parts = line.split(',');
        return { Name: parts[0].trim(), Score: parseFloat(parts[1].trim()) };
      });
    }
    
    function parseCSVTeam(csvText) {
      const lines = csvText.trim().split('\n');
      lines.shift(); // remove header
      return lines.map(line => {
        const parts = line.split(',');
        return { Name: parts[0].trim(), Score: parseFloat(parts[1].trim()), Members: parts[3] };
      });
    }

    function displayRankingIndividual(data) {
      const tbody = document.getElementById('individual-body');
      tbody.innerHTML = '';

      data.sort((a, b) => b.Score - a.Score);

      data.forEach((row, index) => {
        const tr = document.createElement('tr');
        if (index < 150) tr.classList.add('top-n');
        if (index < 3) tr.classList.add('top-3');
        tr.innerHTML = `
          <td class="rank">${index + 1}</td>
          <td>${row.Name}</td>
          <td>${row.Score}</td>
        `;
        tbody.appendChild(tr);
      });
    }
    
    function displayRankingTeam(data) {
      const tbody = document.getElementById('team-body');
      tbody.innerHTML = '';

      data.sort((a, b) => b.Score - a.Score);

      data.forEach((row, index) => {
        const tr = document.createElement('tr');
        if (index < 10) tr.classList.add('top-n');
        if (index < 3) tr.classList.add('top-3');
        tr.innerHTML = `
          <td class="rank">${index + 1}</td>
          <td>${row.Name}</td>
          <td>${row.Score}</td>
          <td>${row.Members}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Initialize both rankings
    fetchCSVIndividual(urls.individual)
      .then(data => displayRankingIndividual(data))
      .catch(err => document.getElementById('individual-body').innerHTML = `<tr><td colspan="3" style="color:red; text-align:center;">Error: ${err.message}</td></tr>`);

    fetchCSVTeam(urls.team)
      .then(data => displayRankingTeam(data))
      .catch(err => document.getElementById('team-body').innerHTML = `<tr><td colspan="3" style="color:red; text-align:center;">Error: ${err.message}</td></tr>`);

    // Tab Switching Logic
    const tabs = document.querySelectorAll('.tab-button');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        document.querySelectorAll('table').forEach(table => table.classList.remove('active'));
        document.getElementById(tab.dataset.target).classList.add('active');
      });
    });
  </script>
</body>
</html>
